<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title> BioAI Teachable AI</title>

<!-- TensorFlow JS -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
/* ---- Global ---- */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: 'Poppins', sans-serif;
}

body {
  background: #f4f6f8;
  color: #333;
}

/* ---- Header ---- */
header {
  background: #1a73e8;
  color: white;
  padding: 20px 40px;
  font-size: 24px;
  font-weight: 600;
  text-align: left;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

/* ---- Tabs ---- */
.tabs {
  display: flex;
  gap: 10px;
  padding: 10px 40px;
  background: #fff;
}

.tabs button {
  background: #e8eaed;
  border: none;
  padding: 8px 15px;
  border-radius: 20px;
  cursor: pointer;
  font-weight: 600;
}
.tabs button.active {
  background: #1a73e8;
  color: white;
}

/* ---- Container ---- */
.container {
  display: flex;
  flex-wrap: wrap;
  gap: 30px;
  max-width: 1100px;
  margin: 30px auto;
  padding: 0 15px;
}

/* ---- Left & Right Panels ---- */
.left, .right {
  background: white;
  border-radius: 12px;
  padding: 25px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.08);
}

.left { flex: 1 1 60%; }
.right { flex: 1 1 35%; }

/* ---- Class Boxes ---- */
.class-box {
  border: 1px solid #ddd;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 20px;
  transition: all 0.3s ease;
}

.class-box:hover {
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.class-title {
  font-weight: 600;
  font-size: 18px;
  margin-bottom: 12px;
}

/* ---- Buttons ---- */
button {
  padding: 10px 20px;
  background: #1a73e8;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  margin-top: 10px;
  transition: all 0.3s ease;
}
button:hover { background: #1558b0; }
button:disabled { background: #aaa; cursor: not-allowed; }

/* ---- Input File Custom ---- */
input[type=file] { display: none; }
.file-label {
  display: inline-block;
  background: #1a73e8;
  color: white;
  padding: 8px 15px;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.3s;
  margin-bottom: 10px;
}
.file-label:hover { background: #1558b0; }

/* ---- Preview & Output ---- */
#preview {
  border-radius: 12px;
  max-width: 100%;
  margin-bottom: 15px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

h4 { margin-bottom: 12px; font-size: 20px; font-weight: 600; }

/* ---- Bars ---- */
.bar-container { margin-bottom: 15px; }
.bar-label {
  display: flex;
  justify-content: space-between;
  margin-bottom: 5px;
  font-weight: 500;
}
.bar {
  width: 100%;
  height: 25px;
  background: #e0e0e0;
  border-radius: 12px;
  overflow: hidden;
}
.fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #ffb74d, #ff8a65);
  border-radius: 12px;
  text-align: right;
  padding-right: 10px;
  color: white;
  font-weight: 600;
  line-height: 25px;
  transition: width 0.5s ease;
}

/* ---- Instruction Box ---- */
#instruction { margin-top: 10px; font-weight: 600; }

/* ---- Status ---- */
#status { margin-top: 15px; font-weight: 500; color: #555; }

/* ---- Responsive ---- */
@media (max-width: 900px) {
  .container { flex-direction: column; }
  .left, .right { width: 100%; }
}
</style>
</head>

<body>

<header>BioAI Detector Machineüíªü§ñ‚öôÔ∏è</header>

<!-- Tabs -->
<div class="tabs">
  <button class="active" onclick="setMode('bone', this)">Bonesü¶¥</button>
  <button onclick="setMode('cancer', this)">Cancerüß¨</button>
  <button onclick="setMode('dental', this)">Dentalü¶∑</button>
  <button onclick="setMode('skin', this)">Skinüß¥</button>
  <button onclick="setMode('eye', this)">EyeüëÅÔ∏è</button>
</div>

<div class="container">

  <!-- LEFT PANEL -->
  <div class="left">
    <div class="class-box">
      <div id="class0Title" class="class-title">Class 1</div>
      <label class="file-label" for="file0">Upload Images</label>
      <input id="file0" type="file" multiple accept="image/*" onchange="loadImages(event, 0)">
      <p id="count0">0 images</p>
    </div>

    <div class="class-box">
      <div id="class1Title" class="class-title">Class 2</div>
      <label class="file-label" for="file1">Upload Images</label>
      <input id="file1" type="file" multiple accept="image/*" onchange="loadImages(event, 1)">
      <p id="count1">0 images</p>
    </div>

    <button onclick="trainModel()">Train Model</button>
    <p id="status">Waiting for data...</p>
  </div>

  <!-- RIGHT PANEL -->
  <div class="right">
    <h3>Preview</h3>
    <label class="file-label" for="predictFile">Upload Image to Predict</label>
    <input id="predictFile" type="file" accept="image/*" onchange="predictImage(event)">
    <br><br>
    <img id="preview" width="250">

    <h4>Output</h4>
    <div class="bar-container">
      <div class="bar-label"><span id="label0">Class 1</span><span id="percent0">0%</span></div>
      <div class="bar"><div id="bar0" class="fill">0%</div></div>
    </div>
    <div class="bar-container">
      <div class="bar-label"><span id="label1">Class 2</span><span id="percent1">0%</span></div>
      <div class="bar"><div id="bar1" class="fill">0%</div></div>
    </div>
    <div id="instruction">Instructions will appear here after prediction.</div>
  </div>

</div>

<script>
let net;
let xs = [];
let ys = [];
let currentMode = "bone";

const modes = {
  bone: {
    classes: ["Broken Bone", "Normal Bone"],
    instructions: [
      "Possible fracture detected. Visit the nearest doctor immediately.",
      "Bone appears normal. No visible damage detected."
    ]
  },
  cancer: {
    classes: ["Cancer Cells", "Normal Cells"],
    instructions: [
      "Abnormal cell growth detected. Further medical testing is advised.",
      "Cells appear healthy."
    ]
  },
  dental: {
    classes: ["Dental Issue", "Healthy Tooth"],
    instructions: [
      "Possible cavity or infection detected. Dentist consultation recommended.",
      "Teeth appear healthy."
    ]
  },
  skin: {
    classes: ["Skin Condition", "Normal Skin"],
    instructions: [
      "Possible skin condition detected. Dermatologist visit recommended.",
      "Skin appears normal."
    ]
  },
  eye: {
    classes: ["Eye Infection", "Healthy Eye"],
    instructions: [
      "Eye irritation or infection detected. Medical advice is recommended.",
      "Eye appears healthy."
    ]
  }
};

function setMode(mode, btn) {
  currentMode = mode;
  document.querySelectorAll(".tabs button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");

  document.getElementById("class0Title").innerText = modes[mode].classes[0];
  document.getElementById("class1Title").innerText = modes[mode].classes[1];
  document.getElementById("label0").innerText = modes[mode].classes[0];
  document.getElementById("label1").innerText = modes[mode].classes[1];

  // Reset data
  xs = [];
  ys = [];
  document.getElementById("count0").innerText = "0 images";
  document.getElementById("count1").innerText = "0 images";
  document.getElementById("status").innerText = "Waiting for data...";
  document.getElementById("instruction").innerText = "Instructions will appear here after prediction.";
  document.getElementById("bar0").style.width = "0%";
  document.getElementById("bar0").innerText = "0%";
  document.getElementById("bar1").style.width = "0%";
  document.getElementById("bar1").innerText = "0%";
  document.getElementById("percent0").innerText = "0%";
  document.getElementById("percent1").innerText = "0%";
}

async function init() {
  net = await mobilenet.load();
  document.getElementById("status").innerText = "Model ready. Upload images.";
}

async function loadImages(event, label) {
  const files = event.target.files;
  for (let file of files) {
    const img = new Image();
    img.src = URL.createObjectURL(file);
    await img.decode();

    const tensor = tf.browser.fromPixels(img)
      .resizeNearestNeighbor([224,224])
      .toFloat()
      .expandDims();

    const activation = net.infer(tensor,true);
    xs.push(activation);
    ys.push(label);
  }
  document.getElementById(`count${label}`).innerText = `${files.length} images loaded`;
}

async function trainModel() {
  if (xs.length === 0) { alert("Upload images first!"); return; }

  document.getElementById("status").innerText = "Training...";

  const labels = tf.tensor1d(ys,"int32");
  const oneHot = tf.oneHot(labels,2);

  const model = tf.sequential();
  model.add(tf.layers.dense({inputShape:[1024], units:2, activation:"softmax"}));
  model.compile({optimizer:"adam", loss:"categoricalCrossentropy"});

  const xsTensor = tf.concat(xs);
  await model.fit(xsTensor,oneHot,{epochs:20});

  window.trainedModel = model;
  document.getElementById("status").innerText = "Model trained!";
}

async function predictImage(event) {
  const file = event.target.files[0];
  if (!window.trainedModel) return alert("Train model first!");

  const img = document.getElementById("preview");
  img.src = URL.createObjectURL(file);
  await img.decode();

  const tensor = tf.browser.fromPixels(img)
    .resizeNearestNeighbor([224,224])
    .toFloat()
    .expandDims();

  const activation = net.infer(tensor,true);
  const prediction = window.trainedModel.predict(activation).dataSync();

  // Update bars and percentages
  for (let i = 0; i < prediction.length; i++) {
    const percent = (prediction[i]*100).toFixed(1);
    document.getElementById(`bar${i}`).style.width = `${percent}%`;
    document.getElementById(`bar${i}`).innerText = `${percent}%`;
    document.getElementById(`percent${i}`).innerText = `${percent}%`;
  }

  // Instruction
  const index = prediction[0] > prediction[1] ? 0 : 1;
  document.getElementById("instruction").innerText = modes[currentMode].instructions[index];
}

init();
</script>

</body>
</html>
